<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Planification de rendez-vous avec OptaPlanner</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/469/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/469/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/469/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/469/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/469/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/469/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/469/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                        <meta name="description" content="" />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/469/blog/dev/planification-de-rdv-avec-optaplanner" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Planification de rendez-vous avec OptaPlanner" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/469/blog/dev/planification-de-rdv-avec-optaplanner" />
            <meta property="og:site_name" content="elao_" />
                                        <meta property="og:image" content="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-teacher-agenda.png/e80d1b8c077a36beb78c17e125d609c9.png">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Planification de rendez-vous avec OptaPlanner">
            <meta property="twitter:description" content="">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-teacher-agenda.png/942c0f5e4dc0d47d58c2bad6f8b6f784.png">
                    

    <link rel="alternate" type="application/rss+xml" href="/elao_/pr/469/blog/rss.xml" title="Le blog de l'équipe d'Elao" />

                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/469/build/app.7cf7ca8c.css">
        
                        <script src="/elao_/pr/469/build/runtime.a515db66.js" defer></script><script src="/elao_/pr/469/build/948.5cd95e1a.js" defer></script><script src="/elao_/pr/469/build/190.965acec9.js" defer></script><script src="/elao_/pr/469/build/app.13ec352b.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;469&#x5C;&#x2F;build&#x5C;&#x2F;930.0ca465c0.js&quot;,&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;469&#x5C;&#x2F;build&#x5C;&#x2F;see.467a5c76.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;469&#x5C;&#x2F;build&#x5C;&#x2F;see.24930bce.css&quot;&#x5D;">
    </head>
    <body>
                    <header class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/469/">
                        <span class="screen-reader">Planification de rendez-vous avec OptaPlanner</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/469/nos-services">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/469/methodologie">
                                                                                        <span>Méthodologie</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/469/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/469/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/469/la-tribu">
                                                                                        <span>La tribu</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/469/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/469/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/469/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/469/nos-services">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/469/methodologie">
                                                                                        <span>Méthodologie</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/469/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/469/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/469/la-tribu">
                                                                                        <span>La tribu</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/469/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/469/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main>
                <div class="container">
        <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <a itemprop="item" href="/elao_/pr/469/blog">
                    <span itemprop="name">Blog</span>
                </a>
                <meta itemprop="position" content="1" />
            </li>
            <li class="breadcrumb__item"  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <a itemprop="item" href="#">
                    <span itemprop="name">Planification de rendez-vous avec OptaPlanner</span>
                </a>
                <meta itemprop="position" content="2" />
            </li>
        </ol>

        <div class="article-banner">
            <div class="article-banner__cover" style="background: #f1f1f1 url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/dfea17be6aa16e67d7050117b2d8a50b.png');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/dfea17be6aa16e67d7050117b2d8a50b.png') 1x,
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/de6bd93c50ef86b12c11a610721adea4.png') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/dfea17be6aa16e67d7050117b2d8a50b.png') 1x,
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/de6bd93c50ef86b12c11a610721adea4.png') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/dfea17be6aa16e67d7050117b2d8a50b.png') 1x,
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/de6bd93c50ef86b12c11a610721adea4.png') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/dfea17be6aa16e67d7050117b2d8a50b.png') 1x,
        url('/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-logo.png/de6bd93c50ef86b12c11a610721adea4.png') 2x
    );" data-aos="fade-down"></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a>
                                    <img     src="/elao_/pr/469/resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg"
    srcset="
        /elao_/pr/469/resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg 1x,
        /elao_/pr/469/resized/content/images/members/avatars/rhanna.jpg/595ecfd31fcd439bed40e88acab04bb4.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                        Écrit par
                                                    <a>
                                <strong>Richard Hanna</strong>
                            </a>
                                            </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>10 octobre 2017</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Planification de rendez-vous avec OptaPlanner</h1>
                <p></p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/469/blog/tag/planification" rel="nofollow">#Planification</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/469/blog/tag/optaplanner" rel="nofollow">#Optaplanner</a>
                        </li>
                                    </ul>
            </div>
        </div>

                    <ol class="table-of-content" data-aos="fade-up">
                                    <li class="table-of-content__item">
                        <a href="#le-contexte">Le contexte</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#la-problematique">La problématique</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#probleme-difficile-a-resoudre">Problème difficile à résoudre</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#optaplanner">OptaPlanner</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#le-solveur">Le solveur</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#demo">Demo</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#bilan">Bilan</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#axes-d-amelioration">Axes d&#039;amélioration</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#quand-utiliser-optaplanner">Quand utiliser OptaPlanner ?</a>

                                            </li>
                            </ol>
        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <body><h2 id="le-contexte" class="anchor-title"><a href="#le-contexte">Le contexte</a></h2>
<p>Notre client, Proximum Group avec son produit <a href="https://www.elao.com/fr/etudes-de-cas/vimeet/" target="_blank">Vimeet</a> propose à des
organisateurs d’événements une plateforme de gestion de rendez-vous B2B.</p>
<p>Avant l’événement les participants s’inscrivent sur la plateforme et consultent le catalogue des participants :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-catalogue.png/d4f214535bc0256f11e8044606241919.png" alt="Catalogue Vimeet" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-catalogue.png/d4f214535bc0256f11e8044606241919.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-catalogue.png/db6667481a8703a29c3fc5a272150084.png 2x," id="catalogue-vimeet">
</p>
<p>Les participants demandent en rendez-vous d'autres participants, acceptent ou refusent des propositions de rendez-vous :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-gdr.png/ee0e25f904e4bfd1a8d49899a1b93b08.png" alt="Catalogue Vimeet" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-gdr.png/ee0e25f904e4bfd1a8d49899a1b93b08.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-gdr.png/6c585a663f2f8da8dedb943915f4ecfb.png 2x," id="catalogue-vimeet">
</p>
<p>Avant l’ouverture de l’événement l’agenda des rendez-vous de chaque participant est généré.
Toutes les demandes de rendez-vous acceptées ne sont pas satisfaites faute de disponibilité commune entre les
participants.</p>
<p>Un événement dure un à plusieurs jours durant le(s)quel(s) des professionnels vont se rencontrer en rendez-vous.
La plateforme permet également de gérer d’autres types de rendez-vous comme des recruteurs qui rencontrent des candidats
pendant une journée dédiée.</p>
<h2 id="la-problematique" class="anchor-title"><a href="#la-problematique">La problématique</a></h2>
<p>L'événement dure un ou plusieurs jours et des créneaux de rendez-vous sont définis par l'organisateur.
Une demande de rendez-vous acceptée est transformée en rendez-vous en lui allouant <strong>un créneau de rendez-vous</strong> et
<strong>un lieu de rendez-vous</strong>.</p>
<p>L'objectif de l'organisateur est <strong>de maximiser le nombre de rendez-vous</strong>.</p>
<p>L'objectif d'un participant est <strong>d'avoir le maximum de ses demandes de rendez-vous positionnées en rendez-vous</strong>.</p>
<p>À cela s'ajoutent quelques règles de gestion :</p>
<ul>
<li>chaque participant a un nombre limité de rendez-vous selon le forfait qu'il a choisi,</li>
<li>des priorités entre les types de participants,</li>
<li>priorisation du positionnement d'un rendez-vous sur le lieu attribué au participant plutôt que sur un lieu
mutualisé,</li>
<li>le participant et les lieux peuvent être en indisponibilité pour certains créneaux de rendez-vous.</li>
</ul>
<h2 id="probleme-difficile-a-resoudre" class="anchor-title"><a href="#probleme-difficile-a-resoudre">Problème difficile à résoudre</a></h2>
<p>Il s'agit d'un __<a href="https://fr.wikipedia.org/wiki/Probl%C3%A8me_NP-complet" target="_blank">problème NP-complet</a>__ car le problème est
difficile à résoudre : pour avoir la solution idéale, il faudrait calculer toutes les combinaisons possibles.
Ce qui pourrait prendre des années voire une éternité.</p>
<p>En conséquence, il vaut mieux chercher des <strong>solutions approchées</strong> en limitant le temps de calcul.</p>
<p>Pour cela, nous avons étudié des algorithmes comme
l'<a href="https://fr.wikipedia.org/wiki/Algorithme_de_colonies_de_fourmis" target="_blank">algorithme de colonies de fourmis</a>
ou l'<a href="https://fr.wikipedia.org/wiki/Algorithme_g%C3%A9n%C3%A9tique" target="_blank">algorithme génétique</a>.</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/algorithmes.png/66d17325f7b29288522c64cc8e64276c.png" alt="Algorithme génétique et algorithme de colonies de fourmis" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/algorithmes.png/66d17325f7b29288522c64cc8e64276c.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/algorithmes.png/c6646914352a2ac24d672df392512af2.png 2x," id="algorithme-genetique-et-algorithme-de-colonies-de-fourmis">
</p>
<p>Ce sont des algorithmes difficiles à maîtriser.</p>
<p>Un <em>proof of concept</em> en PHP a été codé pour positionner séquentiellement des rendez-vous puis évaluer la solution
globale. Cela a été intéressant pour comprendre comment modéliser le problème, mais la lenteur des itérations nous a
poussés à aller vers d'autres langages ou vers des librairies Open Source.</p>
<h2 id="optaplanner" class="anchor-title"><a href="#optaplanner">OptaPlanner</a></h2>
<p>Solution Open Source, <a href="https://www.optaplanner.org/" target="_blank">OptaPlanner</a>, est décrit comme un
<strong>solveur de satisfaction de contraintes</strong>.</p>
<p>Sous licence Apache Software et chapeauté par Red Hat, OptaPlanner est écrit en Java et <a href="https://www.drools.org/" target="_blank">Drools</a>,
un meta langage pour écrire des règles de gestion.</p>
<p>OptaPlanner est livré avec des exemples variés :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-examples.png/a7546b694c3802d84e095cd97eb7db69.png" alt="Optaplanner exemples" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-examples.png/a7546b694c3802d84e095cd97eb7db69.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-examples.png/1c8c1df493f8b2732654afbd9bf85af6.png 2x," id="optaplanner-exemples">
</p>
<p>Dont, l'optimisation de l'agenda des professeurs :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-teacher-agenda.png/0ab334c2f70f214320cd0774dab53b89.png" alt="Optimisation agenda de profs" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-teacher-agenda.png/0ab334c2f70f214320cd0774dab53b89.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-teacher-agenda.png/cf5d80509f4a747757a0b5cfb81144b8.png 2x," id="optimisation-agenda-de-profs">
</p>
<p>L'affectation des lits d'un hôpital :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-hospital.png/54873ddff1867f2ac6a55dfe3c902d6c.png" alt="Optimisation lits d'hôpital" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-hospital.png/54873ddff1867f2ac6a55dfe3c902d6c.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-hospital.png/3d9b9c7ee0e52e409c44d3bf8406132e.png 2x," id="optimisation-lits-d-hopital">
</p>
<p>La minimisation du trajet d'un voyageur de commerce :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-traveller.png/7dd6ee6835ea6b9eaa81005b058690b9.png" alt="Optimisation trajet du voyageur de commerce" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-traveller.png/7dd6ee6835ea6b9eaa81005b058690b9.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-traveller.png/3142f16afd842f5c57d9c30c7eb8c51c.png 2x," id="optimisation-trajet-du-voyageur-de-commerce">
</p>
<p>Et même l'optimisation du plan de tables d'un mariage :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-wedding.png/d71acf3c43b24d554c4df9365c90ce3e.png" alt="Optimisation du plan de table de mariage" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-wedding.png/d71acf3c43b24d554c4df9365c90ce3e.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/optaplanner-wedding.png/d4d454c740b26900bc132441c38aa5e0.png 2x," id="optimisation-du-plan-de-table-de-mariage">
</p>
<p>Sous le capot, OptaPlanner implémente de nombreux algorithmes de
<a href="https://fr.wikipedia.org/wiki/Heuristique_(math%C3%A9matiques)" target="_blank">construction heuristique</a>
et de
<a href="https://fr.wikipedia.org/wiki/Recherche_locale_(optimisation)" target="_blank">recherche locale</a>.</p>
<blockquote>
<p><strong>Une heuristique</strong> est une méthode de calcul par l'exploration et qui fournit rapidement une solution acceptable.</p>
<p><strong>Un algorithme de recherche locale</strong> permet de découper le problème en plus petits problèmes pour découvrir des optimums
locaux.</p>
</blockquote>
<h3 id="comment-demarrer-avec-optaplanner" class="anchor-title"><a href="#comment-demarrer-avec-optaplanner">Comment démarrer avec OptaPlanner ?</a></h3>
<p>Notre erreur a été de créer notre problème <em>from scratch</em>. La courbe d'apprentissage d'OptaPlanner semble plutôt
une falaise à gravir par avis de tempête. La bonne idée est de partir d’un exemple proche fourni par OptaPlanner
et l’adapter petit à petit.</p>
<h3 id="modeliser-le-probleme" class="anchor-title"><a href="#modeliser-le-probleme">Modéliser le problème</a></h3>
<p>Il n'est jamais simple de modéliser un problème de planification. Le moyen d'y arriver est de définir :</p>
<ul>
<li><strong>l'Objectif</strong> : ici, maximiser le nombre de rendez-vous positionnés c'est à dire avec un créneau et un lieu.</li>
<li><strong>les ressources</strong> : ici, les <strong>créneaux</strong> de rendez-vous et les <strong>lieux</strong> de rendez-vous.</li>
<li><strong>Contraintes</strong> :
<ul>
<li>"<strong>Hard</strong>" : celles qui empêchent la tenue d'un rendez-vous</li>
<li>"<strong>Soft</strong>" : celles permettant d'optimiser le positionnement des rendez-vous</li>
</ul></li>
</ul>
<h3 id="les-annotations-de-optaplanner" class="anchor-title"><a href="#les-annotations-de-optaplanner">Les annotations de OptaPlanner</a></h3>
<img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/model-annotations.png/09f4e51655ef848606a23db10003d0dd.png" alt="Modèle" title="Modèle" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/model-annotations.png/09f4e51655ef848606a23db10003d0dd.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/model-annotations.png/9030cf22a646ed017c5f2ec3ef42ec2f.png 2x," id="modele">
<p>Voici un extrait du code de MeetingSchedule :</p>
<pre class="code-multiline language-java"><code class="language-java" id="80cec02456f721d7f5b92aa9adcb90ed"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>solution<span class="token punctuation">.</span></span><span class="token class-name">PlanningEntityCollectionProperty</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>solution<span class="token punctuation">.</span></span><span class="token class-name">PlanningScore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>solution<span class="token punctuation">.</span></span><span class="token class-name">PlanningSolution</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>solution<span class="token punctuation">.</span>drools<span class="token punctuation">.</span></span><span class="token class-name">ProblemFactCollectionProperty</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>valuerange<span class="token punctuation">.</span></span><span class="token class-name">ValueRangeProvider</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@PlanningSolution</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MeetingSchedule</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meeting</span><span class="token punctuation">&gt;</span></span> meetingList<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Slot</span><span class="token punctuation">&gt;</span></span> slotList<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spot</span><span class="token punctuation">&gt;</span></span> spotList<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Sheet</span><span class="token punctuation">&gt;</span></span> sheetList<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PlanningEntityCollectionProperty</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meeting</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMeetingList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> meetingList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ValueRangeProvider</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">"slotRange"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ProblemFactCollectionProperty</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Slot</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSlotList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> slotList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ValueRangeProvider</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">"spotRange"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ProblemFactCollectionProperty</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spot</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSpotList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> spotList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ProblemFactCollectionProperty</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ProblemFactCollectionProperty</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Sheet</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSheetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sheetList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Et un extrait du code de Meeting :</p>
<pre class="code-multiline language-java"><code class="language-java" id="1adf729b3e5b2ea4d951178e5d918783"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">PlanningEntity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>variable<span class="token punctuation">.</span></span><span class="token class-name">PlanningVariable</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@PlanningEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Meeting</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Sheet</span><span class="token punctuation">&gt;</span></span> sheetList<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Slot</span> slot <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Spot</span> spot <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PlanningVariable</span><span class="token punctuation">(</span>valueRangeProviderRefs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"slotRange"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Slot</span> <span class="token function">getSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> slot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PlanningVariable</span><span class="token punctuation">(</span>valueRangeProviderRefs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"spotRange"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Spot</span> <span class="token function">getSpot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> spot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>On peut voir que ce code comporte des annotations fournies par OptaPlanner :</p>
<ul>
<li><strong>@PlanningSolution</strong> : définit l'entité d'une solution optimale contenant tous les rendez-vous.</li>
<li><strong>@PlanningEntityCollectionProperty</strong> : définit une collection de <em>PlanningEntity</em>.</li>
<li><strong>@ProblemFactCollectionProperty</strong> : définit qu'une propriété sur une classe <em>PlanningSolution</em> est une collection
de données qui sert au planificateur mais qui ne changent pas lors de la résolution.</li>
<li><strong>@ValueRangeProvider</strong> : fournit les valeurs pouvant être utilisées dans une annotation <em>@PlanningVariable</em>.</li>
<li><strong>@PlanningEntity</strong> : définit l'élément d'une solution, ici un rendez-vous (<em>meeting</em>).</li>
<li><strong>@PlanningVariable</strong> : définit la variable (la ressource) que OptaPlanner attribue au PlanningEntity grâce à ses
algorithmes de construction heuristique. Ici le créneau (<em>slot</em>) et le lieu (<em>spot</em>).</li>
</ul>
<h3 id="les-regles-de-gestion-et-les-contraintes" class="anchor-title"><a href="#les-regles-de-gestion-et-les-contraintes">Les règles de gestion et les contraintes</a></h3>
<p><strong>Décrire les contraintes</strong> de notre problème au solveur d'OptaPlanner est fait en <strong>Drools</strong>.
Grâce à ces règles, OptaPlanner évalue <strong>le score d'une solution</strong>.
L'idée est que chaque règle va permettre d'agir sur ce score, en pénalisant la solution plus ou moins fortement.</p>
<h4 id="contrainte-medium" class="anchor-title"><a href="#contrainte-medium">Contrainte "Medium"</a></h4>
<p>Il s'agit de l'<strong>objectif</strong> : on souhaite maximiser le nombre de rendez-vous positionnés lors d'un événement.
Le score de la solution est <strong>pénalisée de -1</strong> pour chaque rendez-vous non positionné :</p>
<pre class="code-multiline language-java"><code class="language-java" id="73002452a149c82c70a820d82a010c89">rule <span class="token string">"Assign every meeting"</span>
    when
        <span class="token class-name">Meeting</span><span class="token punctuation">(</span><span class="token function">isNotAssigned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    then
        scoreHolder<span class="token punctuation">.</span><span class="token function">addMediumConstraintMatch</span><span class="token punctuation">(</span>kcontext<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end</code></pre>
<h4 id="contrainte-hard" class="anchor-title"><a href="#contrainte-hard">Contrainte "Hard"</a></h4>
<p>Ce sont des contraintes ne permettant pas de positionner un rendez-vous.</p>
<p>Prenons un exemple : le rendez-vous ne peut pas être positionné sur un créneau de rendez-vous si les participants sont
indisponibles durant ce créneau.</p>
<p>En langage Drools, on peut appeler une méthode du modèle :</p>
<pre class="code-multiline language-java"><code class="language-java" id="5abf7a05ef153d12b0cc88e8b30625e9">rule <span class="token string">"Unavailability conflict"</span>
    when
        <span class="token class-name">Meeting</span><span class="token punctuation">(</span><span class="token function">hasUnavailabilityConflict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    then
        scoreHolder<span class="token punctuation">.</span><span class="token function">addHardConstraintMatch</span><span class="token punctuation">(</span>kcontext<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end</code></pre>
<p>et dans le modèle Meeting :</p>
<pre class="code-multiline language-java"><code class="language-java" id="e82e08479d66cdfa5ae33bab5547dcc8"><span class="token annotation punctuation">@PlanningEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Meeting</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasUnavailabilityConflict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> slot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Slot</span><span class="token punctuation">&gt;</span></span> unavailabilityList  <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUnavailabilityList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>unavailabilityList <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Slot</span> unavailability <span class="token operator">:</span> unavailabilityList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>slot <span class="token operator">==</span> unavailability<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Prenons un exemple un peu plus complexe :
lorsque la fiche de participant a consommé tous ses crédits de rendez-vous, il n'est pas possible de lui positionner un
nouveau rendez-vous :</p>
<pre class="code-multiline language-java"><code class="language-java" id="4b806ff616fb86bf078001ca91bf6c9e">rule <span class="token string">"Sheet do not have enought meetings quantity conflict"</span>
    when
        $sheet <span class="token operator">:</span> <span class="token class-name">Sheet</span><span class="token punctuation">(</span>$possibleMeetingsQuantity <span class="token operator">:</span> possibleMeetingsQuantity<span class="token punctuation">)</span>
        <span class="token function">accumulate</span><span class="token punctuation">(</span>
            $meeting <span class="token operator">:</span> <span class="token class-name">Meeting</span><span class="token punctuation">(</span><span class="token function">isAssigned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sheetList contains $sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            $totalMeetingBySheet <span class="token operator">:</span> <span class="token function">count</span><span class="token punctuation">(</span>$meeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
            $totalMeetingBySheet <span class="token operator">&gt;</span> $possibleMeetingsQuantity
        <span class="token punctuation">)</span>
    then
        scoreHolder<span class="token punctuation">.</span><span class="token function">addHardConstraintMatch</span><span class="token punctuation">(</span>kcontext<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end</code></pre>
<h4 id="contrainte-soft" class="anchor-title"><a href="#contrainte-soft">Contrainte "Soft"</a></h4>
<p>Ce sont les contraintes qui permettent d'optimiser la satisfaction des participants ou d'optimiser l'utilisation des
ressources.</p>
<p>Par exemple, nous allons satisfaire équitablement chaque participant en fonction du nombre de rendez-vous possibles.
Pour cela, il faut calculer un ratio de nombre de rendez-vous positionnés sur le nombre de rendez-vous à positionner et
pénaliser de -1 par palier de 10% :</p>
<pre class="code-multiline language-java"><code class="language-java" id="b1aaeeac7da96907ab1de43a7aa9014d">rule <span class="token string">"Satisfaction : add -1 point penalty per 10% satisfaction = meetings assigned / possibleMeetingsQuantity"</span>
    when
        $sheet <span class="token operator">:</span> <span class="token class-name">Sheet</span><span class="token punctuation">(</span>possibleMeetingsQuantity <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> $possibleMeetingsQuantity <span class="token operator">:</span> possibleMeetingsQuantity<span class="token punctuation">)</span>
        <span class="token function">accumulate</span><span class="token punctuation">(</span>
            $meeting <span class="token operator">:</span> <span class="token class-name">Meeting</span><span class="token punctuation">(</span><span class="token function">isAssigned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sheetList contains $sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            $meetingCount <span class="token operator">:</span> <span class="token function">count</span><span class="token punctuation">(</span>$meeting<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    then
        scoreHolder<span class="token punctuation">.</span><span class="token function">addSoftConstraintMatch</span><span class="token punctuation">(</span>kcontext<span class="token punctuation">,</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> $meetingCount <span class="token operator">/</span> $possibleMeetingsQuantity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end</code></pre>
<h2 id="le-solveur" class="anchor-title"><a href="#le-solveur">Le solveur</a></h2>
<p>Notre configuration du solveur solver-config.xml :</p>
<pre class="code-multiline language-xml"><code class="language-xml" id="2de67e17e965a714526a8589d39b5c84"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>solver</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>solutionClass</span><span class="token punctuation">&gt;</span></span>org.vimeet.meetings.domain.MeetingSchedule<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>solutionClass</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entityClass</span><span class="token punctuation">&gt;</span></span>org.vimeet.meetings.domain.Meeting<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entityClass</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scoreDirectorFactory</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scoreDrl</span><span class="token punctuation">&gt;</span></span>org/vimeet/meetings/solver/meetingsScoreRules.drl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scoreDrl</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scoreDirectorFactory</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructionHeuristic</span><span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localSearch</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>termination</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>minutesSpentLimit</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>minutesSpentLimit</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>termination</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localSearch</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructionHeuristic</span><span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localSearch</span> <span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>termination</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>minutesSpentLimit</span><span class="token punctuation">&gt;</span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>minutesSpentLimit</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>termination</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>solver</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>Le solveur peut être configuré finement. Ici on alterne les phases de construction heuristique et la recherche
locale.
Enfin avec le paramètre <em>termination / minutesSpentLimit</em> on fixe le temps total de calcul à 30 minutes.</p>
<p>On injecte au solveur nos données <em>meetings-not-solved.xml</em> contenant notre modèle de données avec des rendez-vous
sans créneau ni lieu (<em>spot</em> et <em>slot</em> à null) et les ressources disponibles (créneaux, lieux, utilisateurs...) :</p>
<pre class="code-multiline language-java"><code class="language-java" id="fad00446a83eef13597db44b282a979b"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>solver<span class="token punctuation">.</span></span><span class="token class-name">Solver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span>solver<span class="token punctuation">.</span></span><span class="token class-name">SolverFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>meetings<span class="token punctuation">.</span>common<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">SolutionDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>meetings<span class="token punctuation">.</span>meetings<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Meeting</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>meetings<span class="token punctuation">.</span>meetings<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">MeetingSchedule</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>optaplanner<span class="token punctuation">.</span>meetings<span class="token punctuation">.</span>meetings<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">MeetingsDao</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MeetingsCliApp</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Build the Solver</span>
        <span class="token class-name">SolverFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MeetingSchedule</span><span class="token punctuation">&gt;</span></span> solverFactory <span class="token operator">=</span> <span class="token class-name">SolverFactory</span><span class="token punctuation">.</span><span class="token function">createFromXmlResource</span><span class="token punctuation">(</span><span class="token string">"path/to/solver-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Solver</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MeetingSchedule</span><span class="token punctuation">&gt;</span></span> solver <span class="token operator">=</span> solverFactory<span class="token punctuation">.</span><span class="token function">buildSolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Load a problem</span>
        <span class="token class-name">SolutionDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MeetingSchedule</span><span class="token punctuation">&gt;</span></span> meetingsDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MeetingsDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Read the input data</span>
        <span class="token class-name">MeetingSchedule</span> unsolvedMeetingSchedule <span class="token operator">=</span> meetingsDao<span class="token punctuation">.</span><span class="token function">readSolution</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"path/to/meetings-not-solved.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Solve the problem</span>
        <span class="token class-name">MeetingSchedule</span> solvedMeetingSchedule <span class="token operator">=</span> solver<span class="token punctuation">.</span><span class="token function">solve</span><span class="token punctuation">(</span>unsolvedMeetingSchedule<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Write the solution</span>
        meetingsDao<span class="token punctuation">.</span><span class="token function">writeSolution</span><span class="token punctuation">(</span>solvedMeetingSchedule<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"path/to/meetings-solved.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<h2 id="demo" class="anchor-title"><a href="#demo">Demo</a></h2>
<p>Visualisation d'une solution optimale des plannings de rendez-vous des participants d'un événement :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/planner-real-event.gif/5d37a840c273ac91cff07f04cf7b9468.gif" alt="Demo" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/planner-real-event.gif/5d37a840c273ac91cff07f04cf7b9468.gif 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/planner-real-event.gif/b0b51d02140046050020cddafa3d9574.gif 2x," id="demo">
</p>
<ul>
<li><em>Spot</em> : les lieux</li>
<li><em>User</em> : les participants</li>
<li><em>Sheet</em> : les rendez-vous par fiche de participation (généralement équivalente à une fiche société).</li>
</ul>
<p>Le participant a ensuite son agenda des rendez-vous accessible sur son ordinateur ou sur mobile :</p>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-agenda-mobile.png/a027dfee61e5c916ea8add952c67358c.png" alt="Agenda utilisateur" style="height: 600px" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-agenda-mobile.png/a027dfee61e5c916ea8add952c67358c.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/vimeet-agenda-mobile.png/f60a568f572c7ef7f15fd9d5b2b06ff3.png 2x," id="agenda-utilisateur">
</p>
<h2 id="bilan" class="anchor-title"><a href="#bilan">Bilan</a></h2>
<p>Notre instance d'OptaPlanner pour <a href="https://www.elao.com/fr/etudes-de-cas/vimeet/" target="_blank">Vimeet</a> a maintenant réalisé la planification de dizaines d'événements depuis début</p>
<ol start="2017">
<li>Les organisateurs ont noté en moyenne une <strong>augmentation de 10%</strong> des rendez-vous positionnés par rapport à
l'ancienne application de planification des rendez-vous.</li>
</ol>
<p>De plus, les organisateurs d’événements sont maintenant <strong>autonomes</strong> pour réaliser la planification de
rendez-vous. Depuis le backoffice Vimeet, ils cliquent sur un bouton "Planifier" et quelques minutes plus tard,
les agendas de rendez-vous sont créés. L'application de planification est maintenant dépourvue d'UI et est
appelée comme une API.</p>
<p>Le <strong>temps de calcul</strong> pour obtenir une solution acceptable est variable.
Il est fonction des ressources en créneaux et en lieux de l'événement et du nombre de demandes acceptées.
En réalité, on pourrait faire tourner le planificateur autant qu'on le souhaite. <strong>Plus il a de temps de calcul,
plus il va tendre vers une meilleure solution.</strong></p>
<table border="1" style="width: 100%">
    <thead>
        <tr>
            <th></th>
            <th>Demandes de Rdv acceptées</th>
            <th>Rdv positionnés</th>
            <th>% transformation</th>
            <th>Temps de calcul</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th>Event X</th>
            <td class="text-center">630</td>
            <td class="text-center">560</td>
            <td class="text-center">89%</td>
            <td class="text-center">3 minutes</td>
        </tr>
        <tr>
            <th>Event Y</th>
            <td class="text-center">6700</td>
            <td class="text-center">5400</td>
            <td class="text-center">80%</td>
            <td class="text-center">6 heures</td>
        </tr>
    </tbody>
</table>
<p class="text-center">
    <img src="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/stats-planifications.png/3fe77affeb4aecd4d149b5f113ec8a6b.png" alt="Planifications" srcset="/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/stats-planifications.png/3fe77affeb4aecd4d149b5f113ec8a6b.png 1x,
/elao_/pr/469/resized/content/images/blog/2017/planification-de-rdv-avec-optaplanner/stats-planifications.png/03024f02ed9007101c0b57183b4273a4.png 2x," id="planifications">
    <i>Les statistiques et les planifications successives réalisées pour un événement</i>
</p>
<h2 id="axes-d-amelioration" class="anchor-title"><a href="#axes-d-amelioration">Axes d'amélioration</a></h2>
<ul>
<li><strong>Améliorer la vitesse du solveur</strong> : améliorer le modèle, ré-écrire les règles,
<a href="https://docs.optaplanner.org/7.3.0.Final/optaplanner-docs/html_single/index.html#benchmarker" target="_blank">benchmarker les algorithmes</a>...</li>
<li><strong>Ajouter des règles métier pour satisfaire encore plus le participant</strong> : par exemple à la fois diluer les rendez-vous
d’un participant sur la journée mais aussi réduire les écarts entre rendez-vous
(par exemple pas de rendez-vous en début puis en fin de journée).</li>
<li><strong>Faire de la planification en continu</strong> même pendant l’événement pour positionner des rendez-vous en temps réel.</li>
</ul>
<h2 id="quand-utiliser-optaplanner" class="anchor-title"><a href="#quand-utiliser-optaplanner">Quand utiliser OptaPlanner ?</a></h2>
<p>Lorsqu'un problème possède des <strong>objectifs</strong>, des <strong>règles de gestion</strong> et tout cela avec des <strong>ressources limitées</strong>,
c'est très probablement un problème de planification auquel OptaPlanner peut répondre.</p></body>
                                                                </main>
            <aside class="article-content__aside">
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a>
                                <img     src="/elao_/pr/469/resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg"
    srcset="
        /elao_/pr/469/resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg 1x,
        /elao_/pr/469/resized/content/images/members/avatars/rhanna.jpg/595ecfd31fcd439bed40e88acab04bb4.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a>
                                <strong>Richard Hanna</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                            <a href="https://twitter.com/richardhanna" class="social social--small">
                                    <i class="icon icon--twitter" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte twitter de Richard Hanna</span>
                                </a>
                                                                                        <a href="https://github.com/supertanuki " class="social social--small">
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Richard Hanna</span>
                                </a>
                                                                                        <a href="http://www.elao.com" class="social social--small">
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Richard Hanna</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/upgrades/content/blog/dev/planification-de-rdv-avec-optaplanner.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    <footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/469/nos-services">Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/469/methodologie">Méthodologie</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/469/etudes-de-cas">Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/469/nos-valeurs">Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/469/la-tribu">La tribu</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/469/blog">Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/469/blog/rss.xml">RSS</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/469/contact">Contact</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                                                <a href="/elao_/pr/469/recrutement">
                            Nous recrutons
                                                            <span class="bullet">3</span>
                                                    </a>
                    </li>
                    <li>
                        <a href="/elao_/pr/469/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/469/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--twitter"></i>
                            Twitter
                        </a>
                    </li>
                    <li>
                        <a href="https://www.instagram.com/hello_elao_/" target="_blank">
                            <i class="icon icon--instagram"></i>
                            Instagram
                        </a>
                    </li>
                </ul>
            </div>
        </section>
        <section class="footer__legals">
            <span>© 2005 - 2022 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/469/legal">Mentions légales</a>
            <a href="/elao_/pr/469/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
